NineNineFreelas.modules.ConcurrencyMod=function(){function a(){function a(){function a(a,d,e){var f,e=e||{},g=e.autoStart,i=e.callback;return h(),a&&(f={fn:a,handler:d,options:e},k={seed:f},k.updateHandler=b(f),g&&c(i)),j}function b(a){var b=a.fn,c=a.handler,e=a.options,f=d(function(a,d){l?b(function(b){setTimeout(function(b){a(b)},0),l&&c(b)},d):a()},e),g=function(a){l&&f(a)};return g}function c(a){return l||e(a),j}function e(a){return k.updateHandler&&(l||(l=!0),k.updateHandler(a)),j}function f(){return l=!1,j}function g(a,d){return l=!1,k.updateHandler=b(k.seed),a&&c(d),j}function h(){return l=!1,k={},j}function i(){return j.load=a,j.start=c,j.update=e,j.stop=f,j.reload=g,j.clear=h,j}var j={},k={},l=!1;return i()}function c(b){function c(a){var a=a||{},b=function(){};return{beforeLoad:a.beforeLoad||b,afterLoad:a.afterLoad||b,beforeStart:a.beforeStart||b,afterStart:a.afterStart||b,beforeUpdate:a.beforeUpdate||b,afterUpdate:a.afterUpdate||b,beforeStop:a.beforeStop||b,afterStop:a.afterStop||b,beforeReload:a.beforeReload||b,afterReload:a.afterReload||b,beforeClear:a.beforeClear||b,afterClear:a.afterClear||b}}function d(a,b,c){var c=c||{},d=c.autoStart,f=c.callback;return m.beforeLoad(),i(),c.autoStart=!1,l.load(a,b,c),o=!0,d&&e(f),m.afterLoad(),k}function e(a){return o&&!n&&(m.beforeStart(),n=!0,l.start(a),m.afterStart()),k}function f(a){return o&&(m.beforeUpdate(),n?l.update(a):e(a),m.afterUpdate()),k}function g(){return n&&(m.beforeStop(),n=!1,l.stop(),m.afterStop()),k}function h(a,b){return m.beforeReload(),g(),o=!1,l.reload(),o=!0,a&&e(b),m.afterReload(),k}function i(){return o&&(m.beforeClear(),g(),l.clear(),o=!1,m.afterClear()),k}function j(){return k.load=d,k.start=e,k.update=f,k.stop=g,k.reload=h,k.clear=i,k}var k={},l=a(),m=c(b),n=!1,o=!1;return j()}function d(a,b){function c(){var a={finished:!o};return j&&(a.minDate=k),a}function d(a){o=!0,n=!1,setTimeout(function(){k=a,o=!1,p&&(p=!1,e())},h)}function e(b){n||o?(o||!m)&&(p=!0,f.isFunction(b)&&r.push(b)):(n=!0,o=!1,p=!1,r.length&&(q=r,r=[]),f.isFunction(b)&&q.push(b),g=(new Date).getTime()-i,a(function(a){var b,e=q,f=e.length,h=c();if(l||d(g),f)for(q=[],b=0;f>b;b++)e[b](a,h)},c()),l&&d(g))}var g,b=b||{},h=b.TIME_TO_WAIT||0,i=b.TRANSACTION_TIME||0,j=b.useDate,k=b.minDate||0,l=b.direct,m=b.ignoreConcurrency,n=!1,o=!1,p=!1,q=[],r=[];return e}function e(){b.createContext=a,b.createOuterContext=c,b.generateUpdateHandler=d}var f=NineNineFreelas.prepare(NineNineFreelas.utils.ValidationUtils);e()}var b={};return b.prepare=function(){return b.prepare=function(){return b},a(),b},b}();